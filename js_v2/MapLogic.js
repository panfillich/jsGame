//Формируем карту (По сути находим координаты позиций гексагонов)//И создаем логику игры (По сути создаем события) function CreateMapLogic(setting){	CreateMap(setting);	//CreateLogic(setting);}//Формируем карту //тут мы задаем форму карты, //я задам 2 формы 8 - угольная и квадратная//по аналогии можно создать какую угодноfunction CreateMap(setting){	//Размер гексагона	var hex_size_x = setting.hex.size.x;	var hex_size_y = setting.hex.size.y;		//Максимально-возможное кол-во гексагонов по осям	var hex_count_x = setting.hex.count.x;	var hex_count_y = setting.hex.count.y;		//Размеры карты	var map_size_x = setting.map.size.x;	var map_size_y = setting.map.size.y;			//При дальнейшей рабтоте с картой необходимо:	var map = setting.map.store;	//Массив координа всех позиций гексагонов		map.hex = new Array;			//массив id самых нижних позиций y для каждого x		map.hex_last = new Array;			//массив координат позиций, с которых происходит генерация 		//и их статусы (генерирует / свободен)		map.hex_gen = new Array;		//map.hex_gen.border{y}  - 	граница, после при прохождения которой гексагон сигнализирует, 		//							что можно генерировать следующий гексагон 		//							<= 0 т.к. генерация происходит за пределами canvas		map.hex_gen.border = 0;			//Формируем прямоугольную карту	//Формирование начинаем снизу вверх с центра	//Начинаем работать от  x = 0	//Заполняем снизу - вверх, затем смещаемся на след. столбец	var x,y; 					//Позиции В ГЕКСАГОНАХ!	var pos_x, pos_y;			//Позиции верхнего правого угла	var pos_mid_x, pos_mid_y;	//Позиции центра	var	id = 0; 				//Id узла	var id_gen = 0;				//ID узла-генератора			//Находим координаты узлов (центров гексагонов + точек для рисования оных)	for(x = 0; x <  hex_count_x; x++){		//массив координат самых нижних позиций y для каждого x				if(x%2){ 			y = hex_count_y-2;						//Добавляем узел генерации конкретного столбца			map.hex_gen.push(new GenNode(id_gen,(3/4)*x*hex_size_x,-(3/2)*hex_size_y,(3/4)*x*hex_size_x + hex_size_x/2,-hex_size_y));			id_gen++;		} else { 			y = hex_count_y-1;				map.hex_gen.push(new GenNode(id_gen,(3/4)*x*hex_size_x,-hex_size_y, (3/4)*x*hex_size_x + hex_size_x/2, -hex_size_y/2));			id_gen++		}					//Добавляем ID последнего узла и кол-во гексагонов сверху		map.hex_last.push({'id' : id, 'count_hex' : y});				do{ addNode(); id++; y--;} while (y >= 0);	}			//Добавляем узел на карту	//Работаем через замыкания	function addNode(){			//Позиции верхнего правого угла		pos_x = x * 3*(hex_size_x/4);		pos_y = y * hex_size_y;		if(x%2){			pos_y += hex_size_y/2;		}					//Позиции центра		pos_mid_x = pos_x + hex_size_x/2;		pos_mid_y = pos_x + hex_size_x/2;				//Добавляем точку		map.hex.push(			new MapNode(				id, pos_x, pos_y, pos_mid_x, pos_mid_y, id_gen			)		);	}		//Находим соседей	map.hex.forEach(function(hex, i, store){		//Обход по часовой стрелке с 00:00		//(top) -> (right-top) -> (right-down) -> (top) -> (left-down) -> (left-down)			});		//Сохраняем карту	setting.map.store = map;}//Узел function Node(id, x, y, mid_x, mid_y){	//id узла	this.id = id;		//Позиция узла при рисовании и его центр	this.pos = {		'drow_point' : {			'x' : x,			'y' : y		},		'mid' : {			'x' : mid_x,			'y' : mid_y,		}	}}//Обычный узел на картеfunction MapNode(id, x, y, mid_x, mid_y, id_gen){	Node.apply(this, arguments);			//id генератора для данного узла	this.id_gen = id_gen;		//Соседние гексагоны	//Обход по часовой стрелке с 00:00	//(top) -> (right-top) -> (right-down) -> (top) -> (left-down) -> (left-down)	this.neighbors = [0,0,0,0,0,0]		//Связан ли с гексагоном	this.status = 'empty';		//Гексагон, связанный с этой точкой	this.hex = {};		//Тут логика, изменение координат гексагонов и статусов	this.animation = new Function;}//Узел - генератор//Обычный узел на картеfunction GenNode(id, x, y, mid_x, mid_y){	Node.apply(this, arguments);	//Cвободна ли точка	this.status = 'empty';}